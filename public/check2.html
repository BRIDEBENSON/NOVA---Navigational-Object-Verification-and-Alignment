<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astronomical Offset Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .coordinate-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #3498db;
            margin-top: 0;
            font-size: 1.3em;
        }
        .coordinate-group {
            margin-bottom: 15px;
        }
        .coordinate-fields {
            display: flex;
            gap: 10px;
        }
        .field-group {
            flex: 1;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9em;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        #results {
            margin-top: 30px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result-item {
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .result-label {
            font-weight: bold;
            color: #2c3e50;
        }
        .result-value {
            font-size: 1.2em;
            margin-top: 5px;
            color: #16a085;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        .header img {
            width: 50px;
            margin-right: 15px;
        }
        .preset-button {
            padding: 6px 12px;
            background-color: #95a5a6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            margin-right: 10px;
            margin-top: 10px;
        }
        .preset-button:hover {
            background-color: #7f8c8d;
        }
        .note {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Astronomical Offset Calculator</h1>
    </div>
    
    <div class="container">
        <div class="coordinate-section">
            <h2>Current Position (Reticle)</h2>
            <div class="coordinate-group">
                <label>Right Ascension (RA)</label>
                <div class="coordinate-fields">
                    <div class="field-group">
                        <label for="current-ra-h">Hours</label>
                        <input type="number" id="current-ra-h" min="0" max="23" step="1" value="5">
                    </div>
                    <div class="field-group">
                        <label for="current-ra-m">Minutes</label>
                        <input type="number" id="current-ra-m" min="0" max="59" step="1" value="26">
                    </div>
                    <div class="field-group">
                        <label for="current-ra-s">Seconds</label>
                        <input type="number" id="current-ra-s" min="0" max="59.99" step="0.01" value="32.8">
                    </div>
                </div>
            </div>
            
            <div class="coordinate-group">
                <label>Declination (Dec)</label>
                <div class="coordinate-fields">
                    <div class="field-group">
                        <label for="current-dec-d">Degrees</label>
                        <input type="number" id="current-dec-d" min="-90" max="90" step="1" value="7">
                    </div>
                    <div class="field-group">
                        <label for="current-dec-m">Minutes</label>
                        <input type="number" id="current-dec-m" min="0" max="59" step="1" value="24">
                    </div>
                    <div class="field-group">
                        <label for="current-dec-s">Seconds</label>
                        <input type="number" id="current-dec-s" min="0" max="59.99" step="0.01" value="43.5">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="coordinate-section">
            <h2>Target Object</h2>
            <div class="coordinate-group">
                <label>Right Ascension (RA)</label>
                <div class="coordinate-fields">
                    <div class="field-group">
                        <label for="target-ra-h">Hours</label>
                        <input type="number" id="target-ra-h" min="0" max="23" step="1" value="6">
                    </div>
                    <div class="field-group">
                        <label for="target-ra-m">Minutes</label>
                        <input type="number" id="target-ra-m" min="0" max="59" step="1" value="46">
                    </div>
                    <div class="field-group">
                        <label for="target-ra-s">Seconds</label>
                        <input type="number" id="target-ra-s" min="0" max="59.99" step="0.01" value="16.5">
                    </div>
                </div>
            </div>
            
            <div class="coordinate-group">
                <label>Declination (Dec)</label>
                <div class="coordinate-fields">
                    <div class="field-group">
                        <label for="target-dec-d">Degrees</label>
                        <input type="number" id="target-dec-d" min="-90" max="90" step="1" value="-16">
                    </div>
                    <div class="field-group">
                        <label for="target-dec-m">Minutes</label>
                        <input type="number" id="target-dec-m" min="0" max="59" step="1" value="45">
                    </div>
                    <div class="field-group">
                        <label for="target-dec-s">Seconds</label>
                        <input type="number" id="target-dec-s" min="0" max="59.99" step="0.01" value="2.6">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <button id="calculate-btn">Calculate Offset</button>
    <button id="load-example" class="preset-button">Load Example Values</button>
    
    <div id="results" style="display: none;">
        <h2>Offset Results</h2>
        
        <div class="result-item">
            <div class="result-label">RA Offset:</div>
            <div id="ra-offset" class="result-value">0.0000°</div>
            <div id="ra-offset-time" class="note">(0.0 minutes of time)</div>
        </div>
        
        <div class="result-item">
            <div class="result-label">Dec Offset:</div>
            <div id="dec-offset" class="result-value">0.0000°</div>
            <div id="dec-offset-arcmin" class="note">(0.0 arcminutes)</div>
        </div>
        
        <div class="result-item">
            <div class="result-label">Angular Separation:</div>
            <div id="angular-separation" class="result-value">0.0000°</div>
        </div>
    </div>

    <script>
        /**
         * Calculate the offset from current position to target position in degrees.
         * Returns the offset in RA and Dec, accounting for spherical distortion.
         */
        function calculateOffset(
            current_ra_h, current_ra_m, current_ra_s, 
            current_dec_d, current_dec_m, current_dec_s,
            target_ra_h, target_ra_m, target_ra_s, 
            target_dec_d, target_dec_m, target_dec_s
        ) {
            // Convert everything to decimal degrees
            const current_ra = (current_ra_h + current_ra_m/60 + current_ra_s/3600) * 15;
            const current_dec = current_dec_d + current_dec_m/60 + current_dec_s/3600;
            const target_ra = (target_ra_h + target_ra_m/60 + target_ra_s/3600) * 15;
            const target_dec = target_dec_d + target_dec_m/60 + target_dec_s/3600;

            // Calculate RA difference, handling wraparound at 360 degrees
            let ra_diff = target_ra - current_ra;
            if (ra_diff > 180) {
                ra_diff -= 360;
            } else if (ra_diff < -180) {
                ra_diff += 360;
            }

            // Scale RA difference by cos(dec) to account for spherical distortion
            // Use the average declination for the scaling
            const avg_dec = ((current_dec + target_dec) / 2) * Math.PI / 180; // Convert to radians
            const ra_offset = ra_diff * Math.cos(avg_dec);

            // Calculate Dec difference
            const dec_offset = target_dec - current_dec;

            // Calculate true angular separation
            const current_dec_rad = current_dec * Math.PI / 180;
            const target_dec_rad = target_dec * Math.PI / 180;
            const ra_diff_rad = ra_diff * Math.PI / 180;
            
            const angular_sep = Math.acos(
                Math.sin(current_dec_rad) * Math.sin(target_dec_rad) +
                Math.cos(current_dec_rad) * Math.cos(target_dec_rad) *
                Math.cos(ra_diff_rad)
            ) * 180 / Math.PI;

            return {
                ra_offset: ra_offset,  // degrees, negative means move west
                dec_offset: dec_offset,  // degrees, negative means move south
                angular_separation: angular_sep,  // degrees
                ra_offset_time: ra_diff/15,  // hours
                dec_offset_arcmin: dec_offset * 60  // arcminutes
            };
        }

        // Get references to form inputs
        function getInputValues() {
            return {
                current_ra_h: parseFloat(document.getElementById('current-ra-h').value),
                current_ra_m: parseFloat(document.getElementById('current-ra-m').value),
                current_ra_s: parseFloat(document.getElementById('current-ra-s').value),
                current_dec_d: parseFloat(document.getElementById('current-dec-d').value),
                current_dec_m: parseFloat(document.getElementById('current-dec-m').value),
                current_dec_s: parseFloat(document.getElementById('current-dec-s').value),
                target_ra_h: parseFloat(document.getElementById('target-ra-h').value),
                target_ra_m: parseFloat(document.getElementById('target-ra-m').value),
                target_ra_s: parseFloat(document.getElementById('target-ra-s').value),
                target_dec_d: parseFloat(document.getElementById('target-dec-d').value),
                target_dec_m: parseFloat(document.getElementById('target-dec-m').value),
                target_dec_s: parseFloat(document.getElementById('target-dec-s').value)
            };
        }

        // Display results
        function displayResults(results) {
            document.getElementById('ra-offset').textContent = `${results.ra_offset.toFixed(4)}°`;
            document.getElementById('ra-offset-time').textContent = 
                `(${(results.ra_offset_time*60).toFixed(1)} minutes of time)`;
            
            document.getElementById('dec-offset').textContent = `${results.dec_offset.toFixed(4)}°`;
            document.getElementById('dec-offset-arcmin').textContent = 
                `(${results.dec_offset_arcmin.toFixed(1)} arcminutes)`;
            
            document.getElementById('angular-separation').textContent = 
                `${results.angular_separation.toFixed(4)}°`;
            
            document.getElementById('results').style.display = 'block';
        }

        // Set up event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('calculate-btn').addEventListener('click', function() {
                const values = getInputValues();
                const results = calculateOffset(
                    values.current_ra_h, values.current_ra_m, values.current_ra_s,
                    values.current_dec_d, values.current_dec_m, values.current_dec_s,
                    values.target_ra_h, values.target_ra_m, values.target_ra_s,
                    values.target_dec_d, values.target_dec_m, values.target_dec_s
                );
                displayResults(results);
            });

            // Load example values
            document.getElementById('load-example').addEventListener('click', function() {
                document.getElementById('current-ra-h').value = 5;
                document.getElementById('current-ra-m').value = 26;
                document.getElementById('current-ra-s').value = 32.8;
                document.getElementById('current-dec-d').value = 7;
                document.getElementById('current-dec-m').value = 24;
                document.getElementById('current-dec-s').value = 43.5;
                document.getElementById('target-ra-h').value = 6;
                document.getElementById('target-ra-m').value = 46;
                document.getElementById('target-ra-s').value = 16.5;
                document.getElementById('target-dec-d').value = -16;
                document.getElementById('target-dec-m').value = 45;
                document.getElementById('target-dec-s').value = 2.6;
            });
        });
    </script>
</body>
</html>
